# 바이오매스 공헌이익 시뮬레이터

## 1. 프로젝트 개요

발전소의 시간별 SMP(계통한계가격) 변화에 따른 수익(공헌이익)을 시뮬레이션하는 단일 페이지 웹 애플리케이션입니다.

### 기술 스택
- **Framework**: Next.js 14 (App Router)
- **Language**: TypeScript
- **UI Library**: React 18
- **Styling**: Tailwind CSS
- **Component Library**: Shadcn UI
- **Icons**: Lucide React
- **State Management**: React Context API
- **Data Persistence**: Local Storage

### 디자인 시스템
- **Material Design + Fluent Design Hybrid** (기본)
- **Toss Style** (계산식 편집기 및 주요 UI 컴포넌트)
- 깔끔하고 미니멀한 현대적 디자인
- 상세 가이드라인: `design.md` 파일 참조
- 프로젝트 디자인 가이드라인: `.cursorrules` 파일 참조

## 2. 프로젝트 구조

### 2.1 화면 구성

#### 네비게이션 바
- 좌측: CI 로고 + 시스템 이름 ("바이오매스 공헌이익 시뮬레이터")
- 중앙: 탭 네비게이션 (대시보드 | 시뮬레이션 | 설정)
- 고정 위치 (sticky top)

#### 대시보드 탭
- **요약 카드 섹션**: 93MW, 80MW, 65MW 출력별 시간당 수익 및 공헌이익 표시
- **감발 임계값 카드 섹션**: 자동 계산된 감발 임계값 표시
  - 80MW = 65MW 공헌이익 지점
  - 80MW 공헌이익 = 0 지점
  - 65MW 공헌이익 = 0 지점

#### 설정 탭
- **수익 비교 분석 테이블 편집**
  - 각 인자에 대한 계산식 또는 고정값을 편집할 수 있는 기능
  - 사용자 입력값과 계산값을 섹션별로 분리하여 표시
  - 한 줄에 5개씩 블록 형태로 표시 (반응형: 모바일 1열, 태블릿 2-3열, 데스크톱 5열)
  - 블록 클릭 시 아래에 편집 카드 표시
  - 계산식 입력 시 변수 시각적 강조 (빨간색 텍스트, 회색 배경)
  - 변수 자동완성 및 예상 결과 표시 기능

#### 시뮬레이션 탭
- **상단: 입력 및 시뮬레이션 제어**
  - 주요 입력값 (노란색 배경)
  - 감발 임계값 자동 계산 표시 (읽기 전용)
  - 결과 요약 카드 (93MW/80MW/65MW 시간당 수익)
  
- **중단: 메인 분석 테이블**
  - 3개 행 (93MW, 80MW, 65MW)
  - 실시간 계산 및 표시
  - 송전효율, 소내소비율 수정 가능 (노란색 배경)
  - "더보기" 버튼: 93MW ~ 65MW까지 1MW 단위 상세 분석 모달
  
- **하단: 시간대별 SMP 가격 변동 추이**
  - 날짜별 24시간 SMP 가격 표시
  - 감발 기준 설정 기능
  - 요일별 색상 구분 (토요일: 파란색, 일요일: 빨간색)
  - 매뉴얼/전력거래소 탭 전환 기능
  
- **최하단: 2열 카드 섹션**
  - **왼쪽: 공헌이익 비교 차트**
    - Y축: 공헌이익 (백만원), X축: SMP (원/kWh)
    - 출력 레벨별 공헌이익 곡선 (65MW, 80MW, 93MW 기본값)
    - 교차점 표시 및 우위 구간 표시
    - 출력 레벨 편집 기능 (65~95MW, 복수 선택)
  - **오른쪽: 감발 요약 테이블**
    - 감발 기준가격 이하 연속 6시간 이상 구간 감지
    - 가장 긴 구간 우선 선택
    - 감발 평균 SMP, 감발시간, 시간당 수익, 총 금액 계산

### 2.2 컴포넌트 구조

```
components/
├── Navigation.tsx          # 네비게이션 바 (탭 전환)
├── Dashboard.tsx           # 대시보드 탭 컨텐츠
├── Simulation.tsx          # 시뮬레이션 탭 컨텐츠
├── Settings.tsx            # 설정 페이지
├── AnalysisTableEditor.tsx # 수익 비교 분석 테이블 편집기
├── TextFormulaEditor.tsx   # 계산식 텍스트 편집기 (변수 강조, 예상 결과 표시, Toss Style)
├── IntuitiveFormulaEditor.tsx # 직관적 계산식 편집기
├── InputSection.tsx        # 입력 섹션 (주요 입력값, 요약 카드)
├── AnalysisTable.tsx       # 수익 비교 분석 테이블
├── DetailedAnalysisModal.tsx  # 상세 분석 모달 (93MW~65MW 1MW 단위)
├── SMPPriceTable.tsx       # 시간대별 SMP 가격 변동 추이 테이블
├── ContributionProfitChart.tsx  # 공헌이익 비교 차트 (SMP vs 공헌이익)
├── CurtailmentSummary.tsx  # 감발 요약 테이블
└── ui/                     # Shadcn UI 컴포넌트
    ├── button.tsx
    ├── card.tsx
    ├── dialog.tsx
    ├── input.tsx
    ├── label.tsx
    ├── radio-group.tsx
    ├── select.tsx
    ├── table.tsx
    └── textarea.tsx
```

### 2.3 상태 관리

**Context API** (`contexts/AppContext.tsx`)
- `inputParameters`: 기준 SMP, 연료 단가 등
- `curtailmentThresholds`: 감발 임계값 (자동 계산)
- `plantRowInputs`: 출력별 송전효율, 소내소비율
- `hourlySMPData`: 시간대별 SMP 가격 데이터 (매뉴얼)
- `currentSMPData`: 현재 표시 중인 SMP 데이터 (매뉴얼 또는 전력거래소)
- `exchangeSMPData`: 전력거래소에서 불러온 SMP 데이터
- `currentDataSource`: 현재 데이터 소스 ("manual" | "exchange")
- `calculationSettings`: 계산식 편집 설정 (각 인자별 계산식 또는 고정값)

**로컬 스토리지**
- 모든 상태 자동 저장/복원
- 브라우저 새로고침 시에도 데이터 유지

## 3. 핵심 계산 공식

### 3.1 고정 상수
- WC 연료사용량: 700 (톤/일)
- REC 가격: 63 (원)
- 상수 860: kcal/kWh 변환 계수
- 운영일수: 316일 (365 - 49)
- 수전료 기본값: 1,158,000 (원)

### 3.2 계산 순서 및 공식

1. **송전량(MWh/h)** = 출력 * (1 - 소내소비율)
   - 시간당 송전량 (일일 값은 * 24)

2. **발전효율(%)** = 송전효율 / (1 - 소내소비율)

3. **PKS 연료사용량(톤/일)** = (출력 / 발전효율 * 860 * 24 - (700 * WC단위열량)) / PKS단위열량

4. **WC 혼소율(%)** = (700 * WC단위열량) / (PKS연료사용량 * PKS단위열량 + 700 * WC단위열량)

5. **PKS 발전단가(원/kWh)** = PKS단위가격 / PKS단위열량 * 860 / 송전효율 / 1000

6. **WC 발전단가(원/kWh)** = WC단위가격 / WC단위열량 * 860 / 송전효율 / 1000

7. **약품비(원/kWh)**
   - IF (출력 == 93): 7.6
   - ELSE: (93 / 출력) * 7.6 * 0.95
   - *주의: 큰 수가 분자에 위치 (93/80, 93/65)*

8. **수전요금(원/kWh)** = 1,158,000 / (송전량[시간당] * 24 * 316)

9. **매출_전력(백만원)** = (SMP * 출력 * (1 - 소내소비율) * 1000 / 1000 * 24) / 1000000
   - *MW를 kW로 변환: * 1000*

10. **매출_REC(백만원)** = (63 * 출력 * (1 - 소내소비율) * 1000 / 1000 * 24) / 1000000

11. **매출_계(백만원)** = 매출_전력 + 매출_REC

12. **비용_연료비(백만원)** = (PKS연료사용량 * PKS단위가격 + 700 * WC단위가격) / 1000000

13. **비용_약품비(백만원)** = (출력 * (1 - 소내소비율) * 약품비단가 * 1000 / 1000 * 24) / 1000000

14. **비용_수전료(백만원)** = (출력 * (1 - 소내소비율) * 수전요금단가 * 1000 / 1000 * 24) / 1000000

15. **공헌이익(백만원/일)** = 매출_계 - (비용_연료비 + 비용_약품비 + 비용_수전료)

16. **시간당 기대수익(만원)** = 공헌이익(백만원/일) / 24 * 10

### 3.3 감발 임계값 자동 계산

감발 임계값은 사용자 입력이 아닌 **자동 계산**됩니다:

1. **80MW 공헌이익 = 0 지점**
   - 80MW 출력 시 공헌이익이 0이 되는 SMP 가격

2. **80MW = 65MW 공헌이익 지점**
   - 80MW와 65MW의 공헌이익이 같아지는 SMP 가격

3. **65MW 공헌이익 = 0 지점**
   - 65MW 출력 시 공헌이익이 0이 되는 SMP 가격

**계산 함수**: `calculateCurtailmentThresholds()` (`lib/calculations.ts`)

## 4. 주요 기능

### 4.0 계산식 편집 기능
- **수익 비교 분석 테이블 편집**
  - 각 인자에 대한 계산식 또는 고정값을 편집할 수 있는 기능
  - 설정 페이지에서 "수익 비교 분석 테이블 편집" 선택
  - 사용자 입력값과 계산값을 섹션별로 분리하여 표시
  - 한 줄에 5개씩 블록 형태로 표시 (반응형: 모바일 1열, 태블릿 2-3열, 데스크톱 5열)
  - 블록 클릭 시 아래에 편집 카드 표시
- **계산식 입력 편집기 (TextFormulaEditor)**
  - 한글 변수명으로 계산식 입력 가능
  - 변수 시각적 강조: 빨간색 텍스트와 회색 배경의 둥근 사각형으로 표시
  - 변수 자동완성: `/` 키로 변수 목록 표시, 입력 중 자동완성 제공
  - 계산식 예상 결과: 입력한 계산식의 예상 결과를 실시간으로 계산하여 표시
  - 고정값/계산식 모드 선택 가능 (계산식이 기본값으로 먼저 표시)
  - **UI/UX 디자인 (Toss Style 기반)**
    - 좌측 계산식 입력 필드와 우측 예상결과 카드 디자인 완전 일치
    - 배경색: `#F9FAFB` (입력 필드와 동일)
    - Border-radius: `16px` (입력 필드와 동일)
    - 텍스트 크기: `17px font-medium` (입력 필드와 동일)
    - 높이 동기화: ResizeObserver를 사용하여 계산식 입력 필드 높이와 정확히 일치
    - "=" 기호: 계산식과 예상결과 카드 사이에 표시
    - 모드 선택 버튼: 테두리 없음, `rounded-[24px]`, `p-6`, `font-bold`
    - 변수 가이드: 카테고리별 탭으로 필터링 가능
    - 저장/취소 버튼: Primary/Secondary 스타일, `active:scale-[0.96]` 효과
- **변수 매핑 시스템**
  - 영문 변수명을 한글 비즈니스 용어로 자동 변환
  - 카테고리별 변수 그룹화:
    - **사용자 입력 값**: 출력, SMP 가격, 송전효율, 소내소비율, PKS/WC 단위열량, PKS/WC 단위가격
    - **계산 값**: 발전효율, 송전량, PKS 연료사용량, WC 혼소율, PKS/WC 발전단가, 총 발전단가, 약품비, 수전요금, 매출, 비용, 공헌이익, 시간당 수익
    - **고정 값**: WC 연료사용량
  - 변수 설명 및 단위 정보 제공

### 4.1 실시간 계산
- 기준 SMP 변경 시 즉시 모든 수치 재계산
- 송전효율, 소내소비율 수정 시 해당 행만 재계산
- 모든 계산은 `useMemo`로 최적화

### 4.2 숫자 포맷팅
- **천 단위 구분 쉼표**: 모든 숫자에 자동 적용 (예: 1,000)
- **입력 필드**: 사용자 입력 시에도 자동 포맷팅
- **표시 단위**:
  - 금액: 백만원 (소수점 1자리)
  - 시간당 수익: 만원 (소수점 1자리)
  - 단가: 원 (소수점 1자리)
  - 효율: % (소수점 2자리)

### 4.3 상세 분석 모달
- "더보기" 버튼 클릭 시 모달 표시
- 93MW ~ 65MW까지 1MW 단위 분석
- 93MW, 80MW, 65MW는 기준값으로 강조 표시
- 중간 값은 선형 보간(Linear Interpolation)으로 계산

### 4.4 시간대별 SMP 가격 변동 추이
- 날짜별 24시간 SMP 가격 표시
- 감발 기준 설정 기능 (기본값: 80 원/kWh)
- 감발 기준 이하 가격은 빨간색 배경으로 강조
- 요일별 색상 구분 (토요일: 파란색, 일요일: 빨간색)
- 가로 스크롤 없이 24시간 모두 표시
- 매뉴얼/전력거래소 탭 전환 기능
- 대시보드에서 읽기 전용 모드로 표시

### 4.5 공헌이익 비교 차트
- Y축: 공헌이익 (백만원), X축: SMP (원/kWh)
- 출력 레벨별 공헌이익 곡선 표시 (기본: 65MW, 80MW, 93MW)
- 출력 레벨 편집 기능 (65~95MW, 복수 선택 가능)
- 교차점 표시: 흰색 원 + 검은 테두리, 큰 SMP 값 표시
- 우위 구간 가로 그래프 (숫자 선 형태)
  - 각 출력 레벨별 우위 구간을 색상으로 구분하여 시각화
  - 눈금 및 레이블 표시 (0, 25, 50, 75, 100, 125, 150)
  - 막대 그래프 내부에 출력 레벨 레이블 표시
  - 색상: 93MW(검은색), 80MW(빨간색), 65MW(파란색), 정지(회색)
- 정지 구간 표시: 모든 출력 레벨의 공헌이익이 0 이하인 구간
- 범례: 색상 아이콘 + 숫자 범위만 표시 (예: "0 ~ 34 원/kWh"), 가운데 정렬, 여러 줄 표시
- 선형 보간: 65MW, 80MW, 93MW 사이의 출력 레벨은 보간 계산

### 4.6 감발 요약 테이블
- 감발 기준가격 이하 연속 6시간 이상 구간 자동 감지
- 가장 긴 구간 우선 선택 (동일 길이 시 전날 24시와 오늘 1시가 모두 기준 이하인 구간 우선)
- 감발 평균 SMP 계산 (연속 6시간 이상 구간만 집계)
- 감발시간, 시간당 수익, 총 금액 계산
- 매뉴얼/전력거래소 탭 전환에 따른 동적 데이터 표시
- 단위 표시: 시간당 수익 및 총 금액은 "만원" 단위
- 계산 기준 안내: 사용자 이해를 위한 명확한 설명 제공

### 4.7 시각적 피드백
- **입력 필드**: 노란색 배경 (#FFF9E6)
- **공헌이익**: 양수(녹색), 음수(빨간색)
- **매출**: 녹색 강조
- **비용**: 빨간색 강조
- **감발 조건**: 빨간색 배경 (#fcb1b1)

## 5. 데이터 구조

### 5.1 타입 정의 (`types/index.ts`)

```typescript
// 출력 레벨
type OutputLevel = 93 | 80 | 65;

// 입력 파라미터
interface InputParameters {
  baseSMP: number;              // 기준 SMP (원/kWh)
  pksCalorificValue: number;    // PKS 단위열량 (kcal/kg)
  wcCalorificValue: number;     // WC 단위열량 (kcal/kg)
  pksUnitPrice: number;         // PKS 단위가격 (원/톤)
  wcUnitPrice: number;          // WC 단위가격 (원/톤)
}

// 감발 임계값 (자동 계산)
interface CurtailmentThresholds {
  threshold80MW: number;       // 80MW 공헌이익 = 0 지점
  threshold65MW: number;        // 80MW = 65MW 공헌이익 지점
  thresholdStop: number;        // 65MW 공헌이익 = 0 지점
}

// 발전소 행별 입력값
interface PlantRowInput {
  transmissionEfficiency: number;  // 송전효율 (%)
  internalConsumptionRate: number;  // 소내소비율 (%)
}

// 날짜별 시간대별 SMP 가격 데이터
interface DailySMPData {
  date: string;                // 날짜 (YYYY-MM-DD)
  hourlyPrices: number[];      // 24시간 SMP 가격 배열
}

// 시간대별 SMP 가격 변동 추이 데이터
interface HourlySMPData {
  dailyData: DailySMPData[];
}

// 데이터 소스 타입
type DataSource = "manual" | "exchange";
```

### 5.2 기본값

**입력 파라미터**
- 기준 SMP: 150 원/kWh
- PKS 단위열량: 4,000 kcal/kg
- WC 단위열량: 3,750 kcal/kg
- PKS 단위가격: 223,000 원/톤
- WC 단위가격: 49,000 원/톤

**발전소 행별 입력값**
- 93MW: 송전효율 30.4%, 소내소비율 8.4%
- 80MW: 송전효율 30.23%, 소내소비율 8.7%
- 65MW: 송전효율 29.35%, 소내소비율 10.5%

**시간대별 SMP 데이터**
- 기본 3일간 샘플 데이터 포함 (2024-12-13, 2024-12-14, 2024-12-15)

## 6. 개발 가이드

### 6.1 설치 및 실행

```bash
# 의존성 설치
npm install

# 환경 변수 설정
# 프로젝트 루트에 .env.local 파일을 생성하고 다음 내용을 추가:
# NEXT_PUBLIC_DATA_GO_KR_SERVICE_KEY=your_service_key_here
# 
# 공공데이터포털(https://www.data.go.kr)에서 발급받은 서비스 키를 입력하세요.

# 개발 서버 실행
npm run dev

# 프로덕션 빌드
npm run build

# 프로덕션 서버 실행
npm start
```

### 6.1.1 환경 변수 설정

전력거래소 API를 사용하려면 공공데이터포털 서비스 키가 필요합니다:

1. **공공데이터포털에서 서비스 키 발급**
   - https://www.data.go.kr 접속
   - "한국전력거래소_시간별 SMP 및 전력수급예측" API 검색
   - 서비스 신청 후 인증키 발급

2. **.env.local 파일 생성**
   ```bash
   # 프로젝트 루트에 .env.local 파일 생성
   NEXT_PUBLIC_DATA_GO_KR_SERVICE_KEY=발급받은_서비스_키
   ```

3. **개발 서버 재시작**
   ```bash
   # 환경 변수 변경 후 반드시 개발 서버를 재시작해야 합니다
   npm run dev
   ```

**주의사항:**
- `.env.local` 파일은 `.gitignore`에 포함되어 있어 Git에 커밋되지 않습니다
- 환경 변수 이름은 정확히 `NEXT_PUBLIC_DATA_GO_KR_SERVICE_KEY`여야 합니다
- `NEXT_PUBLIC_` 접두사가 있어야 클라이언트 사이드에서 접근 가능합니다

### 6.2 주요 라이브러리

- **Next.js 14**: App Router 사용
- **Tailwind CSS**: 유틸리티 기반 스타일링
- **Shadcn UI**: 컴포넌트 라이브러리
- **Lucide React**: 아이콘
- **Radix UI**: 접근성 기반 UI 프리미티브

### 6.3 코드 구조

```
cursor_biosmp/
├── app/
│   ├── api/
│   │   └── smp/
│   │       └── route.ts      # 전력거래소 SMP API 라우트
│   ├── globals.css          # 전역 스타일
│   ├── layout.tsx           # 루트 레이아웃
│   └── page.tsx             # 메인 페이지
├── components/              # React 컴포넌트
│   └── ui/                  # Shadcn UI 컴포넌트
├── contexts/                # Context API
│   └── AppContext.tsx      # 전역 상태 관리
├── lib/
│   ├── api.ts               # API 유틸리티 (전력거래소 데이터)
│   ├── calculations.ts      # 계산 로직
│   ├── formatters.ts        # 숫자 포맷팅
│   ├── formula-evaluator.ts # 계산식 평가기
│   ├── storage.ts           # 로컬 스토리지
│   ├── utils.ts             # 유틸리티 함수
│   └── variable-mapper.ts   # 변수 매핑 (한글 변수명 변환)
├── types/
│   └── index.ts             # TypeScript 타입 정의
├── public/
│   └── images/
│       └── ci-logo.svg      # CI 로고
├── design.md                # Toss Style 디자인 가이드라인
├── .cursorrules             # 프로젝트 디자인 가이드라인 (Material + Fluent)
├── tailwind.config.ts       # Tailwind 설정
└── package.json
```

### 6.4 주요 기술 구현 세부사항

#### 계산식 편집기 (TextFormulaEditor)
- **ContentEditable 기반**: Rich text 입력을 위한 `contentEditable` div 사용
- **변수 하이라이팅**: 정규식을 사용한 변수 파싱 및 시각적 강조
- **자동완성**: 입력 쿼리 기반 실시간 필터링 및 키보드 네비게이션
- **높이 동기화**: `ResizeObserver` API를 사용하여 계산식 입력 필드와 예상결과 카드 높이 동기화
- **한글-영문 변환**: 한글 변수명을 영문 코드로 변환하여 계산식 평가
- **변수 블록 삭제**: Backspace/Delete 키로 변수 블록 단위 삭제 지원
- **커서 관리**: DOM Range API를 사용한 정확한 커서 위치 제어

#### 계산 로직
- **의존성 순서**: 변수 간 의존성을 고려한 순차적 계산
- **단위 변환**: 내부 계산은 0-1 범위 사용, 표시는 0-100 범위로 변환 (WC 혼소율 등)
- **오류 처리**: 계산식 파싱 오류 시 명확한 에러 메시지 표시
- **실시간 업데이트**: `useMemo`를 사용한 계산 결과 캐싱 및 최적화

#### 상태 관리
- **Context API**: 전역 상태를 Context로 관리하여 prop drilling 방지
- **로컬 스토리지**: 모든 상태를 자동 저장/복원하여 새로고침 후에도 데이터 유지
- **타입 안정성**: TypeScript를 사용한 엄격한 타입 체크

## 7. 주요 변경 이력

### v0.2.3 (최신)
- ✅ **계산식 편집기 UI/UX 전면 개편 (Toss Style)**
  - 좌측 계산식 입력 필드와 우측 예상결과 카드 디자인 완전 일치
    - 배경색, border-radius, 텍스트 크기, 폰트 weight 모두 동일하게 적용
    - ResizeObserver를 사용한 높이 동기화로 픽셀 단위 정확도 달성
  - "=" 기호 추가: 계산식과 예상결과 카드 사이에 표시
  - 모드 선택 버튼 순서 변경: "계산식" → "고정값" 순서로 변경 (계산식이 기본값)
  - 전체 모달 디자인 Toss Style 적용
    - 모드 선택 버튼: 테두리 없음, `rounded-[24px]`, `p-6`, `font-bold`, `active:scale-[0.96]`
    - 입력 필드: `bg-[#F9FAFB]`, `rounded-[16px]`, 테두리 없음, `focus:ring-2`
    - 변수 태그: `shadow-sm`, `rounded-[16px]`, 테두리 없음
    - 변수 가이드: `bg-white rounded-[24px] p-6 shadow-sm`
    - 자동완성 드롭다운: `rounded-[24px]`, `shadow-lg`
    - 저장/취소 버튼: Primary/Secondary 스타일, `active:scale-[0.96]`
  - 변수 카테고리 재분류
    - "기본입력/계산결과/상수" → "사용자 입력 값/계산 값/고정 값"으로 변경
    - 카테고리별 탭으로 필터링 가능
  - 계산식 오류 처리 개선
    - 부분 매칭 및 중복 변수명 문제 해결
    - 변수명 길이 순 정렬 및 word boundary 사용으로 정확한 매칭
  - 계산 로직 일관성 개선
    - 예상결과 계산 로직을 `calculatePlantAnalysis`와 완전히 일치시킴
    - `wcCoFiringRate` 계산 시 0-1 범위 사용 (내부 계산), 0-100 범위 변환 (표시)

### v0.2.2
- ✅ **수익 비교 분석 테이블 편집 기능 개선**
  - 계산식 편집 UI 개선
    - 각 필드를 작은 블록 형태로 표시 (한 줄에 5개씩)
    - 블록 클릭 시 아래에 편집 카드 표시
    - 사용자 입력값과 계산값을 섹션별로 분리 구분
  - 계산식 입력 시 변수 시각적 강조
    - 변수를 빨간색 텍스트와 회색 배경의 둥근 사각형으로 표시
    - 변수임을 명확히 구분할 수 있도록 시각적 피드백 제공
  - 변수 선택 모달 위치 개선
    - 입력 필드 바로 아래에 상대적으로 배치
    - 이상한 위치에 표시되던 문제 해결
  - 계산식 예상 결과 표시 기능 추가
    - 입력한 계산식의 예상 결과를 실시간으로 계산하여 표시
    - 기본값(93MW 기준)으로 계산된 예상 결과 제공
    - 계산 오류 시 안내 메시지 표시
- ✅ **코드 품질 개선**
  - SonarQube 경고 대부분 수정
    - String.raw 사용으로 이스케이프 문자 처리 개선
    - replaceAll 사용으로 코드 일관성 향상
    - globalThis 사용으로 브라우저 호환성 개선
    - 함수 중첩 깊이 감소 (별도 함수로 추출)
    - Array index key 개선 (고유 key 생성)
  - 접근성 개선 (aria-label, aria-multiline 추가)

### v0.2.1
- ✅ **공헌이익 비교 차트 개선**
  - 우위 구간 가로 그래프 추가 (숫자 선 형태)
    - 각 출력 레벨별 우위 구간을 색상으로 구분하여 시각화
    - 눈금 및 레이블 표시 (0, 25, 50, 75, 100, 125, 150)
    - 막대 그래프 내부에 출력 레벨 레이블 표시
  - 정지 구간 추가
    - 모든 출력 레벨의 공헌이익이 0 이하인 구간을 "정지"로 표시
    - 회색(#8B95A1)으로 구분하여 표시
    - 정지 구간의 끝점 자동 계산
  - 막대 그래프 색상 복원
    - 93MW: 검은색 (#191F28)
    - 80MW: 빨간색 (#F04452)
    - 65MW: 파란색 (#3182F6)
    - 정지: 회색 (#8B95A1)
  - 범례 개선
    - 여러 줄 표시 (가로 스크롤 제거)
    - 간소화: 색상 아이콘 + 숫자 범위만 표시 (예: "0 ~ 34 원/kWh")
    - 가운데 정렬
  - 편집 모달 버튼 스타일 개선
    - 취소 버튼: 텍스트 링크 스타일 (호버 시 밑줄)
    - 저장 버튼: Primary 버튼 스타일 (최소 너비 120px)
- ✅ **감발 요약 테이블 문구 개선**
  - 설명 문구 간소화 및 명확화
  - "전날 24시와 오늘 1시가 모두 기준 이하인 구간을 우선 선택합니다"로 변경

### v0.2.0
- ✅ **Toss 스타일 디자인 시스템 전면 개편**
  - 모든 컴포넌트에 Toss 디자인 시스템 적용
  - Typography: Pretendard 폰트, 큰 글씨, 볼드체
  - Color Palette: Toss 브랜드 컬러 적용 (#3182F6, #F04452, #191F28 등)
  - Border Radius: Super ellipse (24px, 20px, 18px, 16px)
  - Shadow: 단순화된 그림자 시스템
- ✅ **공헌이익 비교 차트 추가** (`ContributionProfitChart`)
  - Y축: 공헌이익 (백만원), X축: SMP (원/kWh)
  - 65MW, 80MW, 93MW 출력별 공헌이익 곡선 표시
  - 교차점 표시 (흰색 원 + 검은 테두리, 큰 SMP 값 표시)
  - 출력 레벨 편집 기능 (65~95MW, 복수 선택 가능)
  - 우위 구간 표시 (어떤 출력이 가장 수익성이 높은지)
- ✅ **감발 요약 테이블 추가** (`CurtailmentSummary`)
  - 감발 기준가격 이하 연속 6시간 이상 구간 감지
  - 가장 긴 구간 우선 선택 (동일 길이 시 전날 연속 구간 우선)
  - 감발 평균 SMP, 감발시간, 시간당 수익, 총 금액 계산
  - 매뉴얼/전력거래소 탭 전환에 따른 동적 데이터 표시
  - 단위 표시 (만원)
- ✅ **대시보드 개선**
  - 시간대별 SMP 가격 변동 추이 테이블 추가 (읽기 전용)
  - 시뮬레이션 탭과 동일한 데이터 소스 사용
  - 매뉴얼/전력거래소 탭 전환 기능
- ✅ **데이터 소스 관리 개선**
  - `AppContext`에 `exchangeSMPData`, `currentDataSource` 추가
  - 매뉴얼/전력거래소 데이터 분리 관리
  - 시뮬레이션 탭과 대시보드 탭 간 데이터 동기화
- ✅ **UI 개선**
  - 편집 모달 버튼 스타일 개선 (취소: 텍스트 링크 스타일, 저장: Primary 버튼)
    - DialogFooter 제거, 커스텀 div로 교체
    - 취소 버튼: 텍스트 링크 스타일 (호버 시 밑줄)
    - 저장 버튼: 최소 너비 120px, Primary 버튼 스타일
    - 간격 및 정렬 개선 (gap-4, items-center)
  - 모든 테이블 헤더에 `whitespace-nowrap` 적용 (줄바꿈 방지)
  - PKS/WC 연료사용량(톤) 컬럼 추가
  - Toss 스타일 일관성 적용
  - 린터 경고 해결 (sortedSelectedOutputs useMemo 최적화)

### v0.1.0
- ✅ Next.js App Router 기반 프로젝트 구성
- ✅ Material Design + Fluent Design Hybrid 디자인 시스템 적용
- ✅ 네비게이션 바 및 탭 구조 (대시보드/시뮬레이션)
- ✅ 실시간 수익 계산 기능
- ✅ 감발 임계값 자동 계산 기능
- ✅ 상세 분석 모달 (93MW~65MW 1MW 단위)
- ✅ 시간대별 SMP 가격 변동 추이 테이블
- ✅ 숫자 포맷팅 (천 단위 구분 쉼표)
- ✅ 로컬 스토리지 데이터 영속성
- ✅ CI 로고 통합

### 주요 개선사항
- 계산 정확도 향상 (약품비, 수전료 공식 수정)
- UI/UX 개선 (테이블 가독성, 컴팩트한 레이아웃)
- 성능 최적화 (useMemo 활용)
- 타입 안정성 강화 (TypeScript)

## 8. 향후 개선 사항

- [ ] 날짜 추가/삭제 기능 (SMP 가격 테이블)
- [ ] 시간대별 SMP 가격 수정 기능
- [ ] 데이터 내보내기/가져오기 (CSV/Excel)
- [ ] 차트 시각화 (시간대별 SMP 변화)
- [x] 감발 요약 계산기 (우측 패널) - ✅ v0.2.0 완료
- [x] 공헌이익 비교 차트 - ✅ v0.2.0 완료
- [x] 계산식 편집 기능 - ✅ v0.2.2 완료
- [ ] 반응형 디자인 개선 (모바일 대응)

## 9. 참고 자료

- **디자인 가이드라인**: `design.md` 파일 참조 (Toss Style)
- **프로젝트 디자인 가이드라인**: `.cursorrules` 파일 참조 (Material Design + Fluent Design Hybrid)
- **계산 공식 상세**: `lib/calculations.ts` 주석 참조
- **타입 정의**: `types/index.ts` 참조
- **변수 매핑**: `lib/variable-mapper.ts` 참조

---

**프로젝트명**: 바이오매스 공헌이익 시뮬레이터  
**버전**: 0.2.3  
**최종 업데이트**: 2024년 12월
